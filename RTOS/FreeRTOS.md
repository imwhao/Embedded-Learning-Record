# RTOS 入门
## 裸机与 RTOS 特点
裸机：裸机又称为前后台系统，前台系统指的中断服务函数，后台系统指的大循环，即应用程序。

裸机特点：
1. 实时性差：应用程序轮流执行
2. delay：空等待，CPU 不执行其他代码
3. 结构臃肿：实现功能都放在无限循环

RTOS：RTOS 全称为：Real Time OS，就是实时操作系统，强调的是实时性。

RTOS 特点：
1. 分而治之：实现功能划分为多个任务
2. 延时函数：任务调度（高优先级任务进入延时后可把 CPU 使用权交给低优先级任务，待高优先级任务延时结束后收回使用权）
3. 抢占式：高优先级任务抢占低优先级任务
4. 任务堆栈：每个任务都有自己的栈空间，用于保存局部变量以及任务的上下文信息
注意：中断可以打断任意任务。任务可以同等优先级。

## FreeRTOS 简介/基础知识
FreeRTOS 是一个免费的嵌入式实时操作系统。

特点：
1. 免费开源：可商用
2. 可裁剪：FreeRTOS 的核心代码 9000+行，包含在 3 个 `.c` 文件中
3. 简单：简单易用，可移植性非常好
4. 优先级不限：任务优先级分配没有限制，多任务可同一优先级（若所使用最高优先级算法为硬件，则受限于 MCU 架构）
5. 任务不限：可创建的实时任务数量没有软件限制（硬件限制取决于堆栈大小）
6. 抢占/协程/时间片：支持抢占式，协程式、时间片流转任务调度

### 任务调度
FreeRTOS 支持三种任务调度方式：
1. 抢占式调度：主要是针对优先级不同的任务，每个任务都有一个优先级，优先级高的任务可以抢占优先级低的任务（数值越大优先级越高）
2. 时间片调度：主要针对优先级相同的任务，当多个任务的优先级相同时，任务调度器会在每一次系统时钟节拍到的时候切换任务，时间片的大小取决于滴答定时器时钟频率
3. 协程式调度：当前执行任务将会一直运行，同时高优先级的任务不会抢占低优先级任务（官方不再更新）

### 任务状态
FreeRTOS 中任务共存在 4 种状态：
1. 运行态：正在执行的任务处于运行态（在 stm32 中同一时间仅有一个任务处于运行态）
2. 就绪态：如果该任务已经能够被执行，但当前还未被执行，那么该任务处于就绪态
3. 阻塞态：如果一个任务因延时或等待外部事件发生，那么这个任务就处于阻塞态
4. 挂起态：类似暂停，调用函数 `vTaskSuspend()` 进入挂起态，需要调用解挂函数 `vTaskResume()` 才可以进入就绪态
注：只有就绪态能转变成运行态。这四种状态中，除了运行态，其他三种任务状态的任务都有其对应的任务状态列表。调度器总是在所有处于就绪列表的任务中选择具有最高优先级的任务来执行。

# FreeRTOS 移植
移植步骤：
1. 添加 FreeRTOS 源码：将 FreeRTOS 源码添加至基础工程、头文件路径等
2. 添加 `FreeRTOSConfig.h` 配置文件
3. 修改 SYSTEM 文件：修改 SYSTEM 文件中的 `sys.c`、`delay.c`、`usart.c`
4. 修改中断相关文件：修改 Systick 中断、SVC 中断、PendSV 中断
5. 添加应用程序：验证移植是否成功












